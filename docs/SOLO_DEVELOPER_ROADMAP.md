# ä¸ªäººå¼€å‘è€…å®æ–½è·¯çº¿å›¾ - AIä¸ªæ€§åŒ–å­¦ä¹ ç³»ç»Ÿ

## ğŸ¯ æ ¸å¿ƒåŸåˆ™

ä½œä¸ºä¸ªäººå¼€å‘è€…ï¼Œæˆ‘ä»¬è¦éµå¾ª:
- âœ… **MVPä¼˜å…ˆ**: å…ˆåšæœ€å°å¯è¡Œäº§å“ï¼Œå¿«é€ŸéªŒè¯
- âœ… **æ¸è¿›å¢å¼º**: é€æ­¥æ·»åŠ åŠŸèƒ½ï¼Œé¿å…è¿‡åº¦è®¾è®¡
- âœ… **å¤ç”¨ä¼˜å…ˆ**: æœ€å¤§åŒ–åˆ©ç”¨ç°æœ‰ä»£ç å’ŒAIèƒ½åŠ›
- âœ… **æ•°æ®é©±åŠ¨**: ç”¨çœŸå®æ•°æ®æŒ‡å¯¼ä¼˜åŒ–æ–¹å‘
- âœ… **80/20æ³•åˆ™**: ç”¨20%çš„åŠªåŠ›å®ç°80%çš„ä»·å€¼

---

## ğŸ“Š æ–¹æ¡ˆå¯¹æ¯”

### æ–¹æ¡ˆA: è½»é‡çº§æ™ºèƒ½åŒ– (æ¨èâ­â­â­â­â­)
**æ—¶é—´æŠ•å…¥**: 2-3å‘¨  
**æŠ€æœ¯éš¾åº¦**: â­â­â­  
**ä»·å€¼äº§å‡º**: â­â­â­â­â­

**æ ¸å¿ƒæ€è·¯**: 
- ä¸å»ºå¤æ‚çš„å­¦ç”Ÿç”»åƒç³»ç»Ÿ
- åˆ©ç”¨AIçš„"ä¸Šä¸‹æ–‡å­¦ä¹ "èƒ½åŠ›
- é€šè¿‡promptå·¥ç¨‹å®ç°ä¸ªæ€§åŒ–
- ç”¨ç®€å•çš„è§„åˆ™ + AIç”Ÿæˆå†…å®¹

**é€‚åˆåœºæ™¯**: 
- âœ… å¿«é€Ÿä¸Šçº¿éªŒè¯æƒ³æ³•
- âœ… ä¸ªäººå¼€å‘è€…
- âœ… æƒ³è¦å¿«é€Ÿçœ‹åˆ°æ•ˆæœ

---

### æ–¹æ¡ˆB: ä¸­åº¦ä¸ªæ€§åŒ–ç³»ç»Ÿ (å¹³è¡¡æ–¹æ¡ˆ)
**æ—¶é—´æŠ•å…¥**: 4-6å‘¨  
**æŠ€æœ¯éš¾åº¦**: â­â­â­â­  
**ä»·å€¼äº§å‡º**: â­â­â­â­

**æ ¸å¿ƒæ€è·¯**:
- å»ºç«‹åŸºç¡€çš„å­¦ç”Ÿç”»åƒ
- ç®€åŒ–çš„çŸ¥è¯†å›¾è°±
- åŸºäºè§„åˆ™çš„å†³ç­–å¼•æ“
- AIè¾…åŠ©å†…å®¹ç”Ÿæˆ

**é€‚åˆåœºæ™¯**:
- âœ… æœ‰ä¸€å®šå¼€å‘æ—¶é—´
- âœ… æƒ³è¦æ›´ç²¾å‡†çš„ä¸ªæ€§åŒ–
- âœ… è®¡åˆ’é•¿æœŸè¿è¥

---

### æ–¹æ¡ˆC: å®Œæ•´ç†è®ºé©±åŠ¨ç³»ç»Ÿ (é•¿æœŸç›®æ ‡)
**æ—¶é—´æŠ•å…¥**: 8-12å‘¨  
**æŠ€æœ¯éš¾åº¦**: â­â­â­â­â­  
**ä»·å€¼äº§å‡º**: â­â­â­â­â­

**æ ¸å¿ƒæ€è·¯**:
- å®Œæ•´çš„å­¦ç”Ÿç”»åƒå¼•æ“
- AIå†³ç­–å¼•æ“
- è‡ªé€‚åº”å­¦ä¹ è·¯å¾„
- å…ƒè®¤çŸ¥åŸ¹å…»ç³»ç»Ÿ

**é€‚åˆåœºæ™¯**:
- âœ… å›¢é˜Ÿå¼€å‘
- âœ… æœ‰å……è¶³æ—¶é—´å’Œèµ„æº
- âœ… è¿½æ±‚æè‡´ä½“éªŒ

---

## ğŸš€ æ¨èæ–¹æ¡ˆ: è½»é‡çº§æ™ºèƒ½åŒ– (æ–¹æ¡ˆA)

### ä¸ºä»€ä¹ˆé€‰æ‹©è¿™ä¸ªæ–¹æ¡ˆ?

1. **å¿«é€ŸéªŒè¯**: 2-3å‘¨å°±èƒ½ä¸Šçº¿ï¼Œå¿«é€Ÿè·å¾—ç”¨æˆ·åé¦ˆ
2. **ä½æˆæœ¬**: ä¸éœ€è¦å¤æ‚çš„æ•°æ®åº“è®¾è®¡å’Œç®—æ³•
3. **é«˜çµæ´»**: å®¹æ˜“è°ƒæ•´å’Œè¿­ä»£
4. **AIå‹å¥½**: å……åˆ†åˆ©ç”¨Geminiçš„å¼ºå¤§èƒ½åŠ›

---

## ğŸ“‹ å®æ–½è®¡åˆ’ (3å‘¨å†²åˆº)

### Week 1: åŸºç¡€è®¾æ–½ + æ™ºèƒ½å¯¹è¯

#### Day 1-2: æ•°æ®åº“æ‰©å±• (æœ€å°åŒ–)

```sql
-- åªæ·»åŠ æœ€å¿…è¦çš„è¡¨

-- 1. å­¦ä¹ ä¼šè¯å¢å¼º (æ‰©å±•ç°æœ‰è¡¨)
ALTER TABLE homework_sessions ADD COLUMN IF NOT EXISTS
  learning_context JSONB DEFAULT '{}';
-- å­˜å‚¨: { grade, currentTopic, recentPerformance, preferences }

-- 2. çŸ¥è¯†ç‚¹å¿«ç…§ (ç®€åŒ–ç‰ˆ)
CREATE TABLE IF NOT EXISTS topic_snapshots (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  user_id UUID REFERENCES auth.users(id),
  topic_id VARCHAR(100),
  
  -- ç®€å•çš„æŒæ¡åº¦æŒ‡æ ‡
  attempts INTEGER DEFAULT 0,
  correct INTEGER DEFAULT 0,
  mastery_score DECIMAL(3,2) DEFAULT 0, -- 0-1
  
  -- æœ€åå­¦ä¹ æ—¶é—´
  last_practiced TIMESTAMP DEFAULT NOW(),
  
  -- ç®€å•çš„é—´éš”é‡å¤
  next_review DATE,
  
  UNIQUE(user_id, topic_id)
);

-- 3. AIå¯¹è¯å†å² (ç”¨äºä¸Šä¸‹æ–‡)
CREATE TABLE IF NOT EXISTS ai_conversations (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  user_id UUID REFERENCES auth.users(id),
  topic_id VARCHAR(100),
  
  -- å¯¹è¯å†…å®¹
  messages JSONB NOT NULL, -- [{role, content, timestamp}]
  
  -- å­¦ä¹ æ´å¯Ÿ (AIæ€»ç»“)
  insights JSONB, -- {strengths, weaknesses, suggestions}
  
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW()
);
```

#### Day 3-5: æ™ºèƒ½å¯¹è¯ç³»ç»Ÿ

**æ ¸å¿ƒæ–‡ä»¶**: `src/services/smartTutor.js`

```javascript
// src/services/smartTutor.js

import { supabase } from '../supabase';
import { callGeminiAPI } from './geminiAPI';

export class SmartTutor {
  /**
   * æ™ºèƒ½å¯¹è¯ - æ ¸å¿ƒåŠŸèƒ½
   * é€šè¿‡AIçš„ä¸Šä¸‹æ–‡å­¦ä¹ èƒ½åŠ›å®ç°ä¸ªæ€§åŒ–
   */
  static async chat(userId, topicId, userMessage, conversationHistory = []) {
    // 1. è·å–å­¦ä¹ ä¸Šä¸‹æ–‡
    const context = await this.getLearningContext(userId, topicId);
    
    // 2. æ„å»ºæ™ºèƒ½prompt
    const prompt = this.buildSmartPrompt(context, conversationHistory, userMessage);
    
    // 3. è°ƒç”¨AI
    const aiResponse = await callGeminiAPI(prompt);
    
    // 4. ä¿å­˜å¯¹è¯
    await this.saveConversation(userId, topicId, userMessage, aiResponse);
    
    // 5. æ›´æ–°å­¦ä¹ ä¸Šä¸‹æ–‡
    await this.updateContext(userId, topicId, userMessage, aiResponse);
    
    return aiResponse;
  }
  
  /**
   * è·å–å­¦ä¹ ä¸Šä¸‹æ–‡ (è½»é‡çº§)
   */
  static async getLearningContext(userId, topicId) {
    // è·å–ç”¨æˆ·åŸºæœ¬ä¿¡æ¯
    const { data: settings } = await supabase
      .from('user_settings')
      .select('settings')
      .eq('user_id', userId)
      .single();
    
    const userSettings = settings?.settings || {};
    
    // è·å–çŸ¥è¯†ç‚¹æŒæ¡æƒ…å†µ
    const { data: snapshot } = await supabase
      .from('topic_snapshots')
      .select('*')
      .eq('user_id', userId)
      .eq('topic_id', topicId)
      .single();
    
    // è·å–æœ€è¿‘çš„å­¦ä¹ è¡¨ç°
    const { data: recentSessions } = await supabase
      .from('homework_sessions')
      .select('*')
      .eq('user_id', userId)
      .order('created_at', { ascending: false })
      .limit(5);
    
    return {
      grade: userSettings.profile?.grade || 'åˆä¸­',
      learningStyle: userSettings.learningPreferences || {},
      topicMastery: snapshot?.mastery_score || 0,
      recentPerformance: this.analyzeRecentPerformance(recentSessions),
      totalSessions: recentSessions?.length || 0
    };
  }
  
  /**
   * æ„å»ºæ™ºèƒ½prompt (è¿™æ˜¯æ ¸å¿ƒ!)
   */
  static buildSmartPrompt(context, history, userMessage) {
    const { grade, learningStyle, topicMastery, recentPerformance } = context;
    
    // åŠ¨æ€è°ƒæ•´æ•™å­¦ç­–ç•¥
    const teachingStrategy = this.selectStrategy(topicMastery);
    
    return `
ä½ æ˜¯ä¸€ä½ç»éªŒä¸°å¯Œçš„æ•°å­¦AIå¯¼å¸ˆ,æ­£åœ¨ä¸ä¸€ä½${grade}å­¦ç”Ÿè¿›è¡Œä¸€å¯¹ä¸€è¾…å¯¼ã€‚

ã€å­¦ç”Ÿç”»åƒã€‘
- å¹´çº§: ${grade}
- å½“å‰çŸ¥è¯†ç‚¹æŒæ¡åº¦: ${(topicMastery * 100).toFixed(0)}%
- å­¦ä¹ é£æ ¼: ${learningStyle.tutoringStyle || 'å¹³è¡¡å‹'}
- æœ€è¿‘è¡¨ç°: ${recentPerformance}

ã€æ•™å­¦ç­–ç•¥ã€‘
${teachingStrategy}

ã€å¯¹è¯å†å²ã€‘
${history.map(m => `${m.role === 'user' ? 'å­¦ç”Ÿ' : 'AIå¯¼å¸ˆ'}: ${m.content}`).join('\n')}

ã€å­¦ç”Ÿåˆšæ‰è¯´ã€‘
"${userMessage}"

ã€ä½ çš„ä»»åŠ¡ã€‘
1. æ ¹æ®å­¦ç”Ÿçš„æŒæ¡åº¦è°ƒæ•´è®²è§£æ·±åº¦
2. ä½¿ç”¨${this.getTeachingApproach(topicMastery)}
3. å¦‚æœå­¦ç”Ÿç†è§£æœ‰å›°éš¾,æ¢ä¸ªè§’åº¦è§£é‡Š
4. å¤šç”¨é¼“åŠ±æ€§è¯­è¨€,åŸ¹å…»æˆé•¿å‹æ€ç»´
5. é€‚æ—¶æå‡ºæ£€æŸ¥ç†è§£çš„é—®é¢˜

ã€é‡è¦åŸåˆ™ã€‘
- ä¸è¦ä¸€æ¬¡æ€§ç»™å¤ªå¤šä¿¡æ¯
- ç”¨ç”Ÿæ´»åŒ–çš„ä¾‹å­
- å¦‚æœå­¦ç”Ÿç­”é”™,ä¸è¦ç›´æ¥è¯´"é”™äº†",è€Œæ˜¯å¼•å¯¼æ€è€ƒ
- ä¿æŒå¯¹è¯è‡ªç„¶ã€å‹å¥½

è¯·å›å¤å­¦ç”Ÿ:
`;
  }
  
  /**
   * æ ¹æ®æŒæ¡åº¦é€‰æ‹©æ•™å­¦ç­–ç•¥
   */
  static selectStrategy(mastery) {
    if (mastery < 0.3) {
      return `
ã€æ–°æ‰‹é˜¶æ®µç­–ç•¥ã€‘
- ä½¿ç”¨å¤§é‡å…·ä½“ä¾‹å­å’Œå›¾åƒ
- åˆ†æ­¥éª¤è¯¦ç»†è®²è§£
- æä¾›worked examples(å®Œæ•´è§£é¢˜ç¤ºèŒƒ)
- é¢‘ç¹æ£€æŸ¥ç†è§£
- å¤šé¼“åŠ±,å»ºç«‹ä¿¡å¿ƒ
`;
    } else if (mastery < 0.7) {
      return `
ã€å‘å±•é˜¶æ®µç­–ç•¥ã€‘
- ä½¿ç”¨å¼•å¯¼æ€§é—®é¢˜,è®©å­¦ç”Ÿæ€è€ƒ
- æä¾›éƒ¨åˆ†ç¤ºä¾‹,è®©å­¦ç”Ÿå®Œæˆå‰©ä½™éƒ¨åˆ†
- é¼“åŠ±å­¦ç”Ÿè§£é‡Šè‡ªå·±çš„æ€è·¯
- é€‚åº¦æŒ‘æˆ˜,ä½†æä¾›æ”¯æŒ
`;
    } else {
      return `
ã€ç²¾é€šé˜¶æ®µç­–ç•¥ã€‘
- æå‡ºæŒ‘æˆ˜æ€§é—®é¢˜
- é¼“åŠ±å­¦ç”Ÿæ¢ç´¢å¤šç§è§£æ³•
- å¼•å¯¼å­¦ç”Ÿå‘ç°è§„å¾‹
- åŸ¹å…»å…ƒè®¤çŸ¥èƒ½åŠ›
- å¯ä»¥ä½¿ç”¨"ç”Ÿäº§æ€§å¤±è´¥"ç­–ç•¥
`;
    }
  }
  
  /**
   * è·å–æ•™å­¦æ–¹æ³•
   */
  static getTeachingApproach(mastery) {
    if (mastery < 0.3) return 'ç›´æ¥æ•™å­¦æ³•,è¯¦ç»†è®²è§£';
    if (mastery < 0.7) return 'è‹æ ¼æ‹‰åº•å¼æé—®,å¼•å¯¼å‘ç°';
    return 'é—®é¢˜é©±åŠ¨,é¼“åŠ±æ¢ç´¢';
  }
  
  /**
   * åˆ†ææœ€è¿‘è¡¨ç°
   */
  static analyzeRecentPerformance(sessions) {
    if (!sessions || sessions.length === 0) return 'é¦–æ¬¡å­¦ä¹ ';
    
    // ç®€å•åˆ†æ:çœ‹æœ€è¿‘çš„æ­£ç¡®ç‡è¶‹åŠ¿
    const recentCorrect = sessions.slice(0, 3).filter(s => 
      s.learning_context?.lastResult === 'correct'
    ).length;
    
    if (recentCorrect >= 2) return 'è¡¨ç°è‰¯å¥½,æ­£åœ¨è¿›æ­¥';
    if (recentCorrect === 1) return 'æœ‰è¿›æ­¥ç©ºé—´';
    return 'éœ€è¦æ›´å¤šç»ƒä¹ å’Œæ”¯æŒ';
  }
  
  /**
   * ä¿å­˜å¯¹è¯
   */
  static async saveConversation(userId, topicId, userMsg, aiMsg) {
    // è·å–ç°æœ‰å¯¹è¯
    const { data: existing } = await supabase
      .from('ai_conversations')
      .select('*')
      .eq('user_id', userId)
      .eq('topic_id', topicId)
      .order('created_at', { ascending: false })
      .limit(1)
      .single();
    
    const newMessage = [
      { role: 'user', content: userMsg, timestamp: new Date().toISOString() },
      { role: 'assistant', content: aiMsg, timestamp: new Date().toISOString() }
    ];
    
    if (existing) {
      // æ›´æ–°ç°æœ‰å¯¹è¯
      const messages = [...existing.messages, ...newMessage];
      await supabase
        .from('ai_conversations')
        .update({ 
          messages,
          updated_at: new Date().toISOString()
        })
        .eq('id', existing.id);
    } else {
      // åˆ›å»ºæ–°å¯¹è¯
      await supabase
        .from('ai_conversations')
        .insert({
          user_id: userId,
          topic_id: topicId,
          messages: newMessage
        });
    }
  }
  
  /**
   * æ›´æ–°å­¦ä¹ ä¸Šä¸‹æ–‡ (ç®€åŒ–ç‰ˆ)
   */
  static async updateContext(userId, topicId, userMsg, aiMsg) {
    // ç®€å•è§„åˆ™:å¦‚æœAIè¯´"å¾ˆå¥½"ã€"æ­£ç¡®"ç­‰,è®¤ä¸ºå­¦ç”Ÿç­”å¯¹äº†
    const isCorrect = this.detectCorrectness(aiMsg);
    
    // æ›´æ–°æˆ–åˆ›å»ºçŸ¥è¯†ç‚¹å¿«ç…§
    const { data: existing } = await supabase
      .from('topic_snapshots')
      .select('*')
      .eq('user_id', userId)
      .eq('topic_id', topicId)
      .single();
    
    if (existing) {
      const newAttempts = existing.attempts + 1;
      const newCorrect = existing.correct + (isCorrect ? 1 : 0);
      const newMastery = newCorrect / newAttempts;
      
      await supabase
        .from('topic_snapshots')
        .update({
          attempts: newAttempts,
          correct: newCorrect,
          mastery_score: newMastery,
          last_practiced: new Date().toISOString(),
          next_review: this.calculateNextReview(newMastery)
        })
        .eq('id', existing.id);
    } else {
      await supabase
        .from('topic_snapshots')
        .insert({
          user_id: userId,
          topic_id: topicId,
          attempts: 1,
          correct: isCorrect ? 1 : 0,
          mastery_score: isCorrect ? 1 : 0,
          next_review: this.calculateNextReview(isCorrect ? 1 : 0)
        });
    }
  }
  
  /**
   * æ£€æµ‹å›ç­”æ­£ç¡®æ€§ (ç®€å•è§„åˆ™)
   */
  static detectCorrectness(aiResponse) {
    const positiveKeywords = ['æ­£ç¡®', 'å¾ˆå¥½', 'å¯¹çš„', 'æ²¡é”™', 'å®Œå…¨æ­£ç¡®', 'å¤ªæ£’äº†'];
    return positiveKeywords.some(keyword => aiResponse.includes(keyword));
  }
  
  /**
   * è®¡ç®—ä¸‹æ¬¡å¤ä¹ æ—¶é—´ (ç®€åŒ–çš„é—´éš”é‡å¤)
   */
  static calculateNextReview(mastery) {
    const intervals = [1, 3, 7, 14, 30]; // å¤©
    const index = Math.min(Math.floor(mastery * intervals.length), intervals.length - 1);
    
    const today = new Date();
    today.setDate(today.getDate() + intervals[index]);
    return today.toISOString().split('T')[0];
  }
}
```

---

### Week 2: æ™ºèƒ½ç»ƒä¹ ç”Ÿæˆ + è‡ªé€‚åº”åé¦ˆ

#### Day 6-8: æ™ºèƒ½ç»ƒä¹ é¢˜ç”Ÿæˆ

```javascript
// src/services/smartPractice.js

export class SmartPractice {
  /**
   * ç”Ÿæˆä¸ªæ€§åŒ–ç»ƒä¹ é¢˜
   */
  static async generateProblems(userId, topicId, count = 5) {
    // 1. è·å–å­¦ä¹ ä¸Šä¸‹æ–‡
    const context = await SmartTutor.getLearningContext(userId, topicId);
    
    // 2. æ„å»ºç”Ÿæˆprompt
    const prompt = this.buildGenerationPrompt(context, topicId, count);
    
    // 3. è°ƒç”¨AIç”Ÿæˆ
    const response = await callGeminiAPI(prompt);
    
    // 4. è§£æå¹¶è¿”å›
    return this.parseProblems(response);
  }
  
  /**
   * æ„å»ºç”Ÿæˆprompt
   */
  static buildGenerationPrompt(context, topicId, count) {
    const { topicMastery, grade } = context;
    
    // æ ¹æ®æŒæ¡åº¦è°ƒæ•´éš¾åº¦
    const difficulty = this.calculateDifficulty(topicMastery);
    
    return `
ä½ æ˜¯ä¸€ä½æ•°å­¦é¢˜åº“ä¸“å®¶,è¯·ä¸º${grade}å­¦ç”Ÿç”Ÿæˆ${count}é“å…³äº"${topicId}"çš„ç»ƒä¹ é¢˜ã€‚

ã€å­¦ç”Ÿæ°´å¹³ã€‘
- å½“å‰æŒæ¡åº¦: ${(topicMastery * 100).toFixed(0)}%
- ç›®æ ‡éš¾åº¦: ${difficulty}

ã€é¢˜ç›®è¦æ±‚ã€‘
1. éš¾åº¦åˆ†å¸ƒ:
   - ${count - 2}é“ é€‚ä¸­é¢˜ (å·©å›ºç†è§£)
   - 1é“ ç®€å•é¢˜ (å»ºç«‹ä¿¡å¿ƒ)
   - 1é“ æŒ‘æˆ˜é¢˜ (æ‹“å±•æ€ç»´)

2. æ¯é“é¢˜åŒ…å«:
   - é¢˜ç›®æè¿°
   - æ ‡å‡†ç­”æ¡ˆ
   - è¯¦ç»†è§£ç­”æ­¥éª¤
   - 3ä¸ªæ¸è¿›å¼æç¤º (è½»åº¦â†’ä¸­åº¦â†’å¼ºåº¦)
   - å¸¸è§é”™è¯¯åˆ†æ

3. é¢˜å‹å¤šæ ·åŒ–:
   - é€‰æ‹©é¢˜ã€å¡«ç©ºé¢˜ã€è§£ç­”é¢˜æ··åˆ
   - åŒ…å«å®é™…åº”ç”¨åœºæ™¯

è¿”å›JSONæ ¼å¼:
{
  "problems": [
    {
      "id": "unique_id",
      "type": "choice|fill|solve",
      "difficulty": 0.6,
      "question": "é¢˜ç›®å†…å®¹",
      "options": ["A", "B", "C", "D"], // ä»…é€‰æ‹©é¢˜
      "answer": "ç­”æ¡ˆ",
      "solution": {
        "steps": ["æ­¥éª¤1", "æ­¥éª¤2", "æ­¥éª¤3"],
        "explanation": "è§£é¢˜æ€è·¯è¯´æ˜"
      },
      "hints": [
        "æç¤º1: è½»åº¦æç¤º",
        "æç¤º2: ä¸­åº¦æç¤º",
        "æç¤º3: å‡ ä¹ç»™å‡ºç­”æ¡ˆçš„æç¤º"
      ],
      "commonMistakes": [
        "å¸¸è§é”™è¯¯1åŠåŸå› ",
        "å¸¸è§é”™è¯¯2åŠåŸå› "
      ]
    }
  ]
}
`;
  }
  
  /**
   * è®¡ç®—ç›®æ ‡éš¾åº¦
   */
  static calculateDifficulty(mastery) {
    // ZPDç†è®º:ç•¥é«˜äºå½“å‰æ°´å¹³
    const base = mastery + 0.1;
    
    if (base < 0.3) return 'åŸºç¡€ (30-40%)';
    if (base < 0.6) return 'ä¸­ç­‰ (50-70%)';
    return 'è¿›é˜¶ (70-85%)';
  }
  
  /**
   * æ™ºèƒ½åé¦ˆ
   */
  static async provideFeedback(userId, problem, studentAnswer) {
    const context = await SmartTutor.getLearningContext(userId, problem.topicId);
    
    const prompt = `
å­¦ç”Ÿåˆšåˆšå®Œæˆäº†ä¸€é“é¢˜,è¯·æä¾›ä¸ªæ€§åŒ–åé¦ˆã€‚

ã€é¢˜ç›®ã€‘
${problem.question}

ã€å­¦ç”Ÿç­”æ¡ˆã€‘
${studentAnswer}

ã€æ ‡å‡†ç­”æ¡ˆã€‘
${problem.answer}

ã€å­¦ç”ŸçŠ¶æ€ã€‘
- æŒæ¡åº¦: ${(context.topicMastery * 100).toFixed(0)}%
- æœ€è¿‘è¡¨ç°: ${context.recentPerformance}

ã€åé¦ˆè¦æ±‚ã€‘
1. åˆ¤æ–­ç­”æ¡ˆæ˜¯å¦æ­£ç¡®
2. å¦‚æœé”™è¯¯:
   - ä¸è¦ç›´æ¥è¯´"é”™äº†",ç”¨æ¸©å’Œçš„æ–¹å¼
   - åˆ†æå¯èƒ½çš„é”™è¯¯åŸå› 
   - æä¾›ä¸€ä¸ªå¼•å¯¼æ€§é—®é¢˜å¸®åŠ©å­¦ç”Ÿå‘ç°é”™è¯¯
   - ç»™äºˆé¼“åŠ±
3. å¦‚æœæ­£ç¡®:
   - å…·ä½“è¡¨æ‰¬åšå¾—å¥½çš„åœ°æ–¹
   - å¯ä»¥æå‡ºä¸€ä¸ªæ‹“å±•æ€§é—®é¢˜

è¿”å›JSONæ ¼å¼:
{
  "isCorrect": true/false,
  "feedback": "åé¦ˆå†…å®¹",
  "guidingQuestion": "å¼•å¯¼æ€§é—®é¢˜(å¦‚æœç­”é”™)",
  "nextStep": "å»ºè®®çš„ä¸‹ä¸€æ­¥è¡ŒåŠ¨"
}
`;
    
    const response = await callGeminiAPI(prompt);
    return JSON.parse(response);
  }
}
```

#### Day 9-10: å‰ç«¯é›†æˆ

```jsx
// src/components/learning/SmartLearningSession.jsx

import { useState, useEffect } from 'react';
import { SmartTutor } from '../../services/smartTutor';
import { SmartPractice } from '../../services/smartPractice';
import { useUser } from '../../context/UserContext';

const SmartLearningSession = ({ topicId, topicName }) => {
  const { user } = useUser();
  const [mode, setMode] = useState('chat'); // chat | practice
  const [messages, setMessages] = useState([]);
  const [problems, setProblems] = useState([]);
  const [currentProblem, setCurrentProblem] = useState(0);
  const [loading, setLoading] = useState(false);
  
  // åˆå§‹åŒ–:AIä¸»åŠ¨æ‰“æ‹›å‘¼
  useEffect(() => {
    initializeSession();
  }, [topicId]);
  
  const initializeSession = async () => {
    const greeting = await SmartTutor.chat(
      user.id,
      topicId,
      `[ç³»ç»Ÿæ¶ˆæ¯:å­¦ç”Ÿåˆšè¿›å…¥${topicName}å­¦ä¹ é¡µé¢]`,
      []
    );
    
    setMessages([
      { role: 'assistant', content: greeting }
    ]);
  };
  
  // å¯¹è¯æ¨¡å¼
  const handleChat = async (userMessage) => {
    setLoading(true);
    
    // æ·»åŠ ç”¨æˆ·æ¶ˆæ¯
    const newMessages = [...messages, { role: 'user', content: userMessage }];
    setMessages(newMessages);
    
    // è·å–AIå›å¤
    const aiResponse = await SmartTutor.chat(
      user.id,
      topicId,
      userMessage,
      messages
    );
    
    setMessages([...newMessages, { role: 'assistant', content: aiResponse }]);
    setLoading(false);
  };
  
  // åˆ‡æ¢åˆ°ç»ƒä¹ æ¨¡å¼
  const startPractice = async () => {
    setLoading(true);
    setMode('practice');
    
    // ç”Ÿæˆä¸ªæ€§åŒ–ç»ƒä¹ é¢˜
    const generatedProblems = await SmartPractice.generateProblems(
      user.id,
      topicId,
      5
    );
    
    setProblems(generatedProblems);
    setCurrentProblem(0);
    setLoading(false);
  };
  
  // æäº¤ç­”æ¡ˆ
  const handleSubmit = async (answer) => {
    setLoading(true);
    
    const problem = problems[currentProblem];
    const feedback = await SmartPractice.provideFeedback(
      user.id,
      problem,
      answer
    );
    
    // æ˜¾ç¤ºåé¦ˆ
    showFeedback(feedback);
    
    setLoading(false);
  };
  
  return (
    <div className="smart-learning-session">
      {/* æ¨¡å¼åˆ‡æ¢ */}
      <div className="mode-switcher">
        <button 
          onClick={() => setMode('chat')}
          className={mode === 'chat' ? 'active' : ''}
        >
          ğŸ’¬ AIå¯¹è¯å­¦ä¹ 
        </button>
        <button 
          onClick={startPractice}
          className={mode === 'practice' ? 'active' : ''}
        >
          âœï¸ æ™ºèƒ½ç»ƒä¹ 
        </button>
      </div>
      
      {/* å¯¹è¯æ¨¡å¼ */}
      {mode === 'chat' && (
        <ChatInterface 
          messages={messages}
          onSend={handleChat}
          loading={loading}
        />
      )}
      
      {/* ç»ƒä¹ æ¨¡å¼ */}
      {mode === 'practice' && problems.length > 0 && (
        <PracticeInterface
          problem={problems[currentProblem]}
          onSubmit={handleSubmit}
          onNext={() => setCurrentProblem(prev => prev + 1)}
          loading={loading}
        />
      )}
    </div>
  );
};
```

---

### Week 3: æ™ºèƒ½å¤ä¹  + æ•°æ®çœ‹æ¿

#### Day 11-12: é—´éš”é‡å¤ç³»ç»Ÿ

```javascript
// src/services/smartReview.js

export class SmartReview {
  /**
   * è·å–ä»Šæ—¥å¤ä¹ ä»»åŠ¡
   */
  static async getTodayReviews(userId) {
    const today = new Date().toISOString().split('T')[0];
    
    const { data } = await supabase
      .from('topic_snapshots')
      .select('*')
      .eq('user_id', userId)
      .lte('next_review', today)
      .order('next_review', { ascending: true });
    
    return data || [];
  }
  
  /**
   * ç”Ÿæˆå¤ä¹ ä¼šè¯
   */
  static async generateReviewSession(userId, topicId) {
    const context = await SmartTutor.getLearningContext(userId, topicId);
    
    const prompt = `
ä¸ºå­¦ç”Ÿç”Ÿæˆä¸€ä¸ªå¤ä¹ ä¼šè¯,å¸®åŠ©å·©å›º"${topicId}"çš„çŸ¥è¯†ã€‚

ã€å­¦ç”ŸçŠ¶æ€ã€‘
- ä¸Šæ¬¡å­¦ä¹ : ${context.lastPracticed}
- æŒæ¡åº¦: ${(context.topicMastery * 100).toFixed(0)}%

ã€å¤ä¹ ç­–ç•¥ã€‘
1. å…ˆç”¨1-2ä¸ªé—®é¢˜å¿«é€Ÿæ£€æµ‹è®°å¿†
2. å¦‚æœè®°å¾—:ç®€å•å·©å›ºåç»“æŸ
3. å¦‚æœå¿˜äº†:é‡æ–°è®²è§£å…³é”®ç‚¹,ç„¶åç»ƒä¹ 

è¯·ç”Ÿæˆå¤ä¹ å¯¹è¯çš„å¼€åœºç™½å’Œç¬¬ä¸€ä¸ªæ£€æµ‹é—®é¢˜ã€‚

è¿”å›JSON:
{
  "greeting": "å¼€åœºç™½",
  "checkQuestion": "æ£€æµ‹é—®é¢˜"
}
`;
    
    const response = await callGeminiAPI(prompt);
    return JSON.parse(response);
  }
}
```

#### Day 13-14: å­¦ä¹ æ•°æ®çœ‹æ¿

```jsx
// src/components/dashboard/LearningInsights.jsx

const LearningInsights = ({ userId }) => {
  const [insights, setInsights] = useState(null);
  
  useEffect(() => {
    loadInsights();
  }, [userId]);
  
  const loadInsights = async () => {
    // è·å–æ‰€æœ‰çŸ¥è¯†ç‚¹å¿«ç…§
    const { data: snapshots } = await supabase
      .from('topic_snapshots')
      .select('*')
      .eq('user_id', userId);
    
    // åˆ†ææ•°æ®
    const analysis = {
      totalTopics: snapshots.length,
      masteredTopics: snapshots.filter(s => s.mastery_score >= 0.9).length,
      needReview: snapshots.filter(s => {
        const today = new Date().toISOString().split('T')[0];
        return s.next_review <= today;
      }).length,
      strengths: snapshots
        .filter(s => s.mastery_score >= 0.8)
        .map(s => s.topic_id),
      weaknesses: snapshots
        .filter(s => s.mastery_score < 0.5)
        .map(s => s.topic_id)
    };
    
    setInsights(analysis);
  };
  
  return (
    <div className="learning-insights">
      <h2>ğŸ“Š å­¦ä¹ æ´å¯Ÿ</h2>
      
      <div className="stats-grid">
        <StatCard 
          icon="ğŸ¯"
          label="å·²æŒæ¡çŸ¥è¯†ç‚¹"
          value={`${insights?.masteredTopics} / ${insights?.totalTopics}`}
        />
        <StatCard 
          icon="ğŸ“…"
          label="ä»Šæ—¥å¾…å¤ä¹ "
          value={insights?.needReview}
          action="å¼€å§‹å¤ä¹ "
        />
      </div>
      
      <div className="strengths-weaknesses">
        <div className="strengths">
          <h3>ğŸ’ª ä½ çš„ä¼˜åŠ¿</h3>
          <ul>
            {insights?.strengths.map(topic => (
              <li key={topic}>{topic}</li>
            ))}
          </ul>
        </div>
        
        <div className="weaknesses">
          <h3>ğŸ¯ éœ€è¦åŠ å¼º</h3>
          <ul>
            {insights?.weaknesses.map(topic => (
              <li key={topic}>
                {topic}
                <button onClick={() => startReview(topic)}>
                  å¤ä¹ 
                </button>
              </li>
            ))}
          </ul>
        </div>
      </div>
    </div>
  );
};
```

#### Day 15: æ•´åˆä¸æµ‹è¯•

- æ•´åˆæ‰€æœ‰åŠŸèƒ½
- ç”¨æˆ·æµ‹è¯•
- ä¿®å¤bug
- ä¼˜åŒ–ä½“éªŒ

---

## ğŸ¯ æ ¸å¿ƒä¼˜åŠ¿

### 1. æç®€å®ç°,æœ€å¤§ä»·å€¼

```
ä¼ ç»Ÿæ–¹æ¡ˆéœ€è¦:
- å¤æ‚çš„å­¦ç”Ÿç”»åƒç³»ç»Ÿ âŒ
- çŸ¥è¯†å›¾è°±æ„å»º âŒ
- å†³ç­–å¼•æ“ç®—æ³• âŒ
- å¤§é‡æ•°æ®æ ‡æ³¨ âŒ

æˆ‘ä»¬çš„æ–¹æ¡ˆ:
- ç®€å•çš„æ•°æ®è¡¨ âœ…
- AIçš„ä¸Šä¸‹æ–‡å­¦ä¹  âœ…
- Promptå·¥ç¨‹ âœ…
- è‡ªç„¶è¯­è¨€äº¤äº’ âœ…
```

### 2. AIåšé‡æ´»

```
ä¸éœ€è¦ä½ å®ç°:
- éš¾åº¦è¯„ä¼°ç®—æ³• â†’ AIåˆ¤æ–­
- é”™è¯¯åˆ†æé€»è¾‘ â†’ AIåˆ†æ
- ä¸ªæ€§åŒ–è®²è§£ â†’ AIç”Ÿæˆ
- æ•™å­¦ç­–ç•¥é€‰æ‹© â†’ AIå†³ç­–
```

### 3. æ¸è¿›å¢å¼º

```
Week 1: åŸºç¡€å¯¹è¯ â†’ å·²ç»æœ‰ä»·å€¼
Week 2: æ™ºèƒ½ç»ƒä¹  â†’ ä»·å€¼ç¿»å€
Week 3: æ™ºèƒ½å¤ä¹  â†’ å½¢æˆé—­ç¯

ä¹‹åå¯ä»¥ç»§ç»­åŠ :
- æ›´ç²¾ç»†çš„å­¦ç”Ÿç”»åƒ
- æ›´å¤æ‚çš„å†³ç­–é€»è¾‘
- æ›´å¤šçš„å­¦ä¹ æ¨¡å¼
```

---

## ğŸ’° æˆæœ¬ä¼°ç®—

### å¼€å‘æˆæœ¬
- **æ—¶é—´**: 3å‘¨ (æ¯å¤©4-6å°æ—¶)
- **æŠ€æœ¯æ ˆ**: ç°æœ‰æŠ€æœ¯æ ˆ,æ— éœ€æ–°å­¦ä¹ 

### è¿è¥æˆæœ¬ (æ¯æœˆ)
- **Gemini API**: $20-50 (å–å†³äºç”¨æˆ·é‡)
- **Supabase**: å…è´¹é¢åº¦è¶³å¤ŸåˆæœŸä½¿ç”¨
- **æ€»è®¡**: < $100/æœˆ

### ROI (æŠ•èµ„å›æŠ¥)
- **ç”¨æˆ·ä½“éªŒ**: æ˜¾è‘—æå‡ â­â­â­â­â­
- **å·®å¼‚åŒ–**: è¿œè¶…æ™®é€šé¢˜åº“ â­â­â­â­â­
- **å¯æ‰©å±•æ€§**: å®¹æ˜“è¿­ä»£ â­â­â­â­â­

---

## ğŸ“Š æ•ˆæœå¯¹æ¯”

### ä¼ ç»Ÿæ–¹å¼ vs æ™ºèƒ½æ–¹å¼

| åŠŸèƒ½ | ä¼ ç»Ÿæ–¹å¼ | æ™ºèƒ½æ–¹å¼ (æˆ‘ä»¬çš„æ–¹æ¡ˆ) |
|------|----------|---------------------|
| **çŸ¥è¯†è®²è§£** | å›ºå®šæ–‡æœ¬ | AIæ ¹æ®å­¦ç”Ÿæ°´å¹³åŠ¨æ€ç”Ÿæˆ |
| **ç»ƒä¹ é¢˜** | é¢˜åº“éšæœºæŠ½å– | AIç”Ÿæˆä¸ªæ€§åŒ–é¢˜ç›® |
| **åé¦ˆ** | "å¯¹"æˆ–"é”™" | AIåˆ†æé”™è¯¯+å¼•å¯¼æ€§åé¦ˆ |
| **å¤ä¹ ** | æ— æˆ–ç®€å•æé†’ | åŸºäºé—å¿˜æ›²çº¿çš„æ™ºèƒ½å¤ä¹  |
| **å­¦ä¹ è·¯å¾„** | çº¿æ€§å›ºå®š | æ ¹æ®æŒæ¡åº¦è‡ªé€‚åº” |
| **å¼€å‘æ—¶é—´** | 1-2ä¸ªæœˆ | 3å‘¨ |

---

## ğŸš€ å¿«é€Ÿå¯åŠ¨æ£€æŸ¥æ¸…å•

### å‡†å¤‡å·¥ä½œ
- [ ] Gemini APIå·²é…ç½®
- [ ] Supabaseå·²è¿æ¥
- [ ] ç°æœ‰ä»£ç ç†Ÿæ‚‰

### Week 1
- [ ] æ•°æ®åº“è¡¨åˆ›å»º
- [ ] SmartTutoræœåŠ¡å®ç°
- [ ] åŸºç¡€å¯¹è¯ç•Œé¢

### Week 2
- [ ] SmartPracticeæœåŠ¡å®ç°
- [ ] ç»ƒä¹ é¢˜ç”Ÿæˆå’Œåé¦ˆ
- [ ] å‰ç«¯é›†æˆ

### Week 3
- [ ] SmartReviewæœåŠ¡å®ç°
- [ ] å­¦ä¹ æ•°æ®çœ‹æ¿
- [ ] æ•´åˆæµ‹è¯•

---

## ğŸ’¡ å…³é”®æˆåŠŸå› ç´ 

### 1. Promptå·¥ç¨‹æ˜¯æ ¸å¿ƒ
```
å¥½çš„prompt = å¥½çš„ä¸ªæ€§åŒ–æ•ˆæœ

æŠ•å…¥æ—¶é—´ä¼˜åŒ–prompt:
- æµ‹è¯•ä¸åŒçš„è¡¨è¿°
- æ”¶é›†çœŸå®æ¡ˆä¾‹
- æŒç»­è¿­ä»£æ”¹è¿›
```

### 2. æ•°æ®é©±åŠ¨è¿­ä»£
```
ä¸Šçº¿å:
1. æ”¶é›†ç”¨æˆ·åé¦ˆ
2. åˆ†æå¯¹è¯æ•°æ®
3. è¯†åˆ«å¸¸è§é—®é¢˜
4. ä¼˜åŒ–promptå’Œé€»è¾‘
```

### 3. ä¿æŒç®€å•
```
ä¸è¦è¿‡æ—©ä¼˜åŒ–:
- å…ˆéªŒè¯æ ¸å¿ƒä»·å€¼
- å†å¢åŠ å¤æ‚åŠŸèƒ½
- å§‹ç»ˆå…³æ³¨ç”¨æˆ·ä½“éªŒ
```

---

## ğŸ“ ä¸‹ä¸€æ­¥è¡ŒåŠ¨

### ç«‹å³å¼€å§‹ (ä»Šå¤©)
1. åˆ›å»ºæ•°æ®åº“è¡¨
2. å®ç°SmartTutoråŸºç¡€ç‰ˆ
3. åšä¸€ä¸ªç®€å•çš„å¯¹è¯æµ‹è¯•

### æœ¬å‘¨å®Œæˆ
1. å®Œæ•´çš„å¯¹è¯ç³»ç»Ÿ
2. åŸºç¡€çš„ä¸Šä¸‹æ–‡è®°å¿†
3. ç®€å•çš„æŒæ¡åº¦è¿½è¸ª

### ä¸‹å‘¨å®Œæˆ
1. æ™ºèƒ½ç»ƒä¹ ç”Ÿæˆ
2. ä¸ªæ€§åŒ–åé¦ˆ
3. å‰ç«¯é›†æˆ

---

## ğŸ“ æ€»ç»“

**ä¸ºä»€ä¹ˆè¿™ä¸ªæ–¹æ¡ˆé€‚åˆä¸ªäººå¼€å‘è€…?**

âœ… **å¿«é€Ÿ**: 3å‘¨ä¸Šçº¿,å¿«é€ŸéªŒè¯  
âœ… **ç®€å•**: ä¸éœ€è¦å¤æ‚ç®—æ³•,AIåšé‡æ´»  
âœ… **æœ‰æ•ˆ**: çœŸæ­£çš„ä¸ªæ€§åŒ–,ä¸æ˜¯å™±å¤´  
âœ… **å¯æ‰©å±•**: å®¹æ˜“è¿­ä»£å’Œå¢å¼º  
âœ… **ä½æˆæœ¬**: APIè´¹ç”¨å¯æ§  

**æ ¸å¿ƒç†å¿µ**:
> ä¸è¦è¯•å›¾ä¸€å¼€å§‹å°±æ„å»ºå®Œç¾ç³»ç»Ÿ  
> å…ˆç”¨æœ€ç®€å•çš„æ–¹å¼å®ç°æ ¸å¿ƒä»·å€¼  
> ç„¶ååŸºäºçœŸå®æ•°æ®æŒç»­ä¼˜åŒ–  

**è®°ä½**:
> AIçš„å¼ºå¤§ä¹‹å¤„åœ¨äºå®ƒçš„"æ™ºèƒ½"  
> æˆ‘ä»¬è¦åšçš„æ˜¯ç»™å®ƒæ­£ç¡®çš„ä¸Šä¸‹æ–‡  
> è€Œä¸æ˜¯é‡æ–°å‘æ˜è½®å­  

---

å‡†å¤‡å¥½å¼€å§‹äº†å—? ğŸš€

æˆ‘å¯ä»¥å¸®ä½ :
1. **ç«‹å³å®ç°** SmartTutorçš„ç¬¬ä¸€ä¸ªç‰ˆæœ¬
2. **ä¼˜åŒ–** ç°æœ‰çš„QuadraticFunctionsé¡µé¢
3. **è®¾è®¡** å…·ä½“çš„promptæ¨¡æ¿

å‘Šè¯‰æˆ‘ä½ æƒ³ä»å“ªé‡Œå¼€å§‹! ğŸ’ª
