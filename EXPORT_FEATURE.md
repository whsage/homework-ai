# 批量导出功能 - 功能说明

## ✨ 新增功能

已成功添加**批量导出作业会话**功能，支持将作业及其完整对话记录导出为文件。

## 🎯 功能特性

### 1. **多格式支持**
- **JSON 格式**: 结构化数据，适合程序处理和数据分析
- **Markdown 格式**: 易读文档，适合人类阅读和归档

### 2. **批量操作**
- 支持单个或多个会话同时导出
- 全选功能快速选择所有会话
- 批量导出 Markdown 时自动分别下载每个文件

### 3. **完整数据**
导出内容包括：
- ✅ 会话基本信息（标题、科目、时间）
- ✅ 完整对话记录
- ✅ AI 的分析、提示、引导（结构化）
- ✅ 图片链接（如有上传）
- ✅ 时间戳

### 4. **用户友好**
- 🎨 直观的下拉菜单选择导出格式
- 📊 实时显示选中数量
- 💬 详细的成功/失败提示
- 🔒 点击外部自动关闭菜单

## 📁 文件结构

```
src/
├── services/
│   ├── exportService.js          # 导出服务核心逻辑
│   └── exportService.test.js     # 测试文件和示例
├── pages/
│   └── History.jsx                # 更新了导出UI
└── ...

docs/
└── EXPORT_GUIDE.md               # 详细使用指南
```

## 🚀 快速开始

1. **进入"我的作业"页面**
2. **点击"管理"按钮**
3. **选择要导出的会话**（可多选）
4. **点击"导出"按钮**
5. **选择格式**（JSON 或 Markdown）
6. **文件自动下载**

## 💻 技术实现

### 核心函数

```javascript
// 导出单个会话为 JSON
exportSessionAsJSON(session)

// 导出单个会话为 Markdown
exportSessionAsMarkdown(session)

// 批量导出多个会话
exportSessions(sessionIds, format)

// 下载文件
downloadJSON(data, filename)
downloadMarkdown(content, filename)
```

### 数据流程

```
用户选择会话
    ↓
选择导出格式
    ↓
从 Supabase 获取会话和消息数据
    ↓
格式化数据（JSON/Markdown）
    ↓
生成文件并触发下载
    ↓
显示成功提示
```

## 📊 导出数据示例

### JSON 格式
```json
{
  "sessionId": "abc123...",
  "title": "数学作业",
  "subject": "数学",
  "createdAt": "2026-01-11T10:30:00Z",
  "totalMessages": 6,
  "conversation": [
    {
      "role": "user",
      "content": "请帮我解题",
      "timestamp": "2026-01-11T10:30:00Z"
    },
    {
      "role": "assistant",
      "content": {
        "analysis": "...",
        "hint": "...",
        "guidance": "..."
      },
      "timestamp": "2026-01-11T10:31:00Z"
    }
  ]
}
```

### Markdown 格式
```markdown
# 数学作业

**科目**: 数学  
**创建时间**: 2026-01-11 10:30:00  

---

## 👤 学生 - 2026-01-11 10:30:00
请帮我解题

---

## 🤖 AI导师 - 2026-01-11 10:31:00

### 📊 分析
...

### 💡 提示
...

### 🎯 引导
...
```

## 🎨 UI 更新

### 新增按钮
- **导出按钮**: 绿色按钮，带下载图标
- **格式选择菜单**: 下拉菜单显示 JSON 和 Markdown 选项

### 新增提示
- **功能说明卡片**: 在页面底部显示导出功能介绍
- **详细反馈**: 导出成功后显示文件位置和数量

## 🔧 配置说明

### 文件命名规则
- 单个会话: `{标题}_{会话ID前8位}_{时间戳}.{格式}`
- 批量 JSON: `homework_batch_{数量}sessions_{时间戳}.json`
- 批量 Markdown: 每个会话独立文件

### 浏览器兼容性
- ✅ Chrome/Edge (推荐)
- ✅ Firefox
- ✅ Safari
- ⚠️ 批量下载可能需要允许多个文件下载权限

## 📝 使用场景

1. **学习复习**: 导出作业记录用于复习
2. **数据备份**: 定期备份重要的学习记录
3. **分享交流**: 导出为 Markdown 分享给老师或同学
4. **数据分析**: 导出为 JSON 进行学习数据分析
5. **打印归档**: 导出为 Markdown 后转换为 PDF 打印

## 🐛 已知限制

1. **图片**: 仅导出图片链接，不包含实际图片文件
2. **批量下载**: Markdown 批量导出时浏览器可能限制同时下载数量
3. **文件大小**: 对话记录很多的会话导出文件可能较大

## 🔮 未来改进

- [ ] 支持导出为 PDF 格式
- [ ] 支持包含实际图片文件的 ZIP 导出
- [ ] 支持重新导入导出的数据
- [ ] 支持自定义导出模板
- [ ] 支持导出时筛选特定时间范围

## 📚 相关文档

- [详细使用指南](./EXPORT_GUIDE.md)
- [测试示例](../src/services/exportService.test.js)

---

**版本**: 1.0.0  
**更新时间**: 2026-01-11  
**作者**: AI Assistant
