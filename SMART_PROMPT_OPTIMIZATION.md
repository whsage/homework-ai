# 智能提示词优化文档

## 📋 问题背景

### 用户反馈的问题

1. **语文题不需要数学公式提示**
   - 当前默认提示词："请精准识别图中的所有文字和数学公式，并以标准的 LaTeX 格式输出公式部分..."
   - 对于语文、英语等文科题目，这个提示显得**生硬且不合适**
   - 用户上传语文题后，看到数学公式相关的提示会感到困惑

2. **缺乏题目类型判断**
   - 所有题目都使用相同的固定提示词
   - 没有根据题目类型智能调整初始提示
   - 需要 AI 先判断题目类型，再给出合适的引导

---

## ✅ 解决方案

### 1. **优化默认提示词**（已完成）

#### 修改位置
`src/services/aiService.js` - 第 441-446 行

#### 修改前
```javascript
text: userMessage || "请精准识别图中的所有文字和数学公式，并以标准的 LaTeX 格式输出公式部分。然后以此为基础，给我提示。",
```

#### 修改后
```javascript
// Smart default prompt based on context
const defaultPrompt = userMessage || "请帮我分析这道题目，引导我思考解题思路。";

messages.push({
    role: "user",
    content: [
        {
            type: "text",
            text: defaultPrompt,
        },
        // ...
    ]
});
```

#### 优化效果
- ✅ 更自然、更开放的表达
- ✅ 不再生硬地要求 LaTeX 格式
- ✅ 让 AI 自己判断题目类型并给出合适的回复
- ✅ 适用于所有学科（数学、语文、英语、物理等）

---

### 2. **增强智能识别策略**（已完成）

#### 修改位置
`src/services/aiService.js` - 系统提示词第一步

#### 修改前
```
📝 **第一步：精准识别与转换**
- 精准识别图中所有文字与数学公式
- 数学/理科公式必须严格使用标准 LaTeX 格式输出
- 确保学科术语的准确性和严谨性
```

#### 修改后
```
📝 **第一步：精准识别与转换**

**智能识别策略：**
- 首先快速浏览图片，判断题目类型（数学/理科 vs 文科）
- 精准识别图中所有文字内容

**分类处理：**
- **数学/理科题目**：数学公式必须严格使用标准 LaTeX 格式输出（如 $\frac{a}{b}$、$x^2$）
- **语文/英语题目**：直接识别文字即可，无需 LaTeX 格式
- **混合题目**：根据具体内容灵活处理

**核心原则：**
- 确保学科术语的准确性和严谨性
- 不要在识别阶段就给出答案或过度分析
- 识别完成后，直接进入引导环节
```

#### 优化效果
- ✅ AI 会先判断题目类型
- ✅ 根据题目类型选择合适的识别策略
- ✅ 语文/英语题目不会被要求使用 LaTeX 格式
- ✅ 数学/理科题目仍然保持严谨的公式输出

---

### 3. **优化 Guidance 字段说明**（待完善）

#### 目标
让 `guidance` 字段的说明更加灵活，明确区分理科和文科的引导方式。

#### 期望格式
```json
{
  "guidance": "详细的引导步骤（根据学科灵活调整）：
    - 理科：逻辑拆解（已知/隐藏/核心）+ 公式+白话解释 + 可视化建议
    - 文科：意象分析 + 语境解读 + 情感体会
    使用Markdown格式，数学公式用$包裹，LaTeX命令用双反斜杠"
}
```

---

## 📊 对比示例

### 示例1：语文题（近义词辨析）

#### 优化前的体验
1. 用户上传语文题图片
2. 系统提示："请精准识别图中的所有文字和数学公式，并以标准的 LaTeX 格式输出公式部分..."
3. 用户困惑：❓ "这是语文题，哪来的数学公式？"

#### 优化后的体验
1. 用户上传语文题图片
2. 系统提示："请帮我分析这道题目，引导我思考解题思路。"
3. AI 识别后：
   - 判断为语文题
   - 直接识别文字内容
   - 聚焦"意象、语境、情感"分析
   - 不会提及 LaTeX 或数学公式

---

### 示例2：数学题（速度计算）

#### 优化前的体验
1. 用户上传数学题图片
2. 系统提示："请精准识别图中的所有文字和数学公式..."
3. AI 正确识别并使用 LaTeX 格式

#### 优化后的体验
1. 用户上传数学题图片
2. 系统提示："请帮我分析这道题目，引导我思考解题思路。"
3. AI 识别后：
   - 判断为数学题
   - 使用 LaTeX 格式输出公式：$v=\frac{s}{t}$
   - 提供白话解释："速度就是单位时间内走过的距离"
   - 逻辑拆解：已知/隐藏/核心

---

## 🎯 核心改进点

### 1. **更自然的用户体验**
- 默认提示词不再生硬
- 不会让用户感到困惑
- 适用于所有学科

### 2. **智能判断题目类型**
- AI 会先快速浏览图片
- 根据内容判断是数学/理科还是文科
- 选择合适的识别和引导策略

### 3. **灵活的引导方式**
- **理科题目**：逻辑拆解 + 公式 + 白话 + 可视化
- **文科题目**：意象 + 语境 + 情感
- 不再一刀切

### 4. **保持专业性**
- 数学/理科题目仍然使用严格的 LaTeX 格式
- 学科术语保持准确性和严谨性
- 不降低教学质量

---

## 📈 预期效果

### 用户体验提升
1. ✅ 语文题不再看到"数学公式"相关提示
2. ✅ 英语题不再看到"LaTeX 格式"相关提示
3. ✅ 所有题目都能得到合适的初始引导
4. ✅ 减少用户困惑，提升信任感

### AI 表现优化
1. ✅ 更智能地判断题目类型
2. ✅ 根据学科选择合适的引导策略
3. ✅ 保持理科题目的严谨性
4. ✅ 增强文科题目的情感共鸣

---

## 🔄 实施状态

- [x] 优化默认提示词（`aiService.js` 第 441 行）
- [x] 增强智能识别策略（系统提示词第一步）
- [ ] 优化 Guidance 字段说明（因转义字符问题待完善）
- [x] 创建优化文档

---

## 🧪 测试建议

### 测试场景1：语文题
1. 上传语文题图片（如近义词辨析、阅读理解）
2. 观察 AI 的初始回复
3. 检查是否提及"数学公式"或"LaTeX"
4. 预期：应该聚焦语境、情感、意象分析

### 测试场景2：数学题
1. 上传数学题图片（如速度计算、方程求解）
2. 观察 AI 的初始回复
3. 检查是否正确使用 LaTeX 格式
4. 预期：应该有公式 + 白话解释 + 逻辑拆解

### 测试场景3：英语题
1. 上传英语题图片（如语法选择、完形填空）
2. 观察 AI 的初始回复
3. 检查是否提及"数学公式"
4. 预期：应该聚焦语法、词汇、语境

---

## 💡 进一步优化建议

### 1. **动态提示词生成**
可以根据图片内容的初步分析，生成更精准的提示词：
```javascript
// 未来可以实现
const generateSmartPrompt = (imageAnalysis) => {
    if (imageAnalysis.hasMathFormula) {
        return "请帮我分析这道数学题，引导我理解解题思路。";
    } else if (imageAnalysis.hasEnglishText) {
        return "请帮我分析这道英语题，引导我理解语法和词汇。";
    } else {
        return "请帮我分析这道题目，引导我思考解题思路。";
    }
};
```

### 2. **学科标签预判**
在图片上传时，可以让用户选择学科标签，进一步优化提示词：
```
[数学] [语文] [英语] [物理] [化学] [生物]
```

### 3. **历史学习偏好**
根据用户的历史学习记录，智能推荐最常用的学科类型。

---

## 📄 相关文档

- `AI_TUTOR_UPGRADE.md` - 全科辅导老师升级文档
- `CLOSURE_LOGIC.md` - 智能收尾逻辑文档
- `src/services/aiService.js` - AI 服务核心代码

---

**更新时间**：2026-01-13  
**版本**：v2.2 - 智能提示词优化  
**状态**：已实施（部分待完善）
