# 避免模板化回复优化文档

## 📋 问题背景

### 用户反馈

用户上传了一道化学实验题（关于保存方法的选择题），AI 的回复过于**模板化和机械**：

- ❌ 生硬地套用"已知条件、隐藏线索、核心方法"框架
- ❌ 即使是简单的实验题，也在列出复杂的逻辑拆解
- ❌ 强行使用"可视化建议"，但题目根本不需要画图
- ❌ 回复显得不自然，缺乏针对性

### 核心问题

AI 机械地套用固定模板，没有根据题目的**实际复杂度和类型**灵活调整引导方式。

---

## ✅ 解决方案

### 1. **优化引导策略**（已完成）

#### 修改位置
`src/services/aiService.js` - 系统提示词"第二步：解题引导"

#### 核心改进

**新增核心原则：灵活引导，避免机械套用模板**

#### 修改前
```
2️⃣ **逻辑拆解**
   - 将题目拆解为三个层次：
     * **已知条件**：题目明确给出的信息
     * **隐藏线索**：需要推理或转换的信息
     * **核心公式/方法**：解决问题的关键工具

3️⃣ **公式+白话**
   - 给出 LaTeX 公式后，必须紧跟一句"浅显的物理/数学意义说明"

🎨 **第四步：可视化建议**
- 鼓励学生画图：受力分析图、函数图像、思维导图
```
❌ 所有题目都套用同一个模板

#### 修改后
```
2️⃣ **灵活拆解（根据题目实际情况调整）**

**复杂题目**（需要深度分析）：
   - 拆解为三个层次：已知条件、隐藏线索、核心公式/方法

**简单题目**（如实验步骤、概念辨析）：
   - 直接聚焦核心要点，不要生硬地套用"已知/隐藏/核心"框架
   - 用自然的语言引导思考
   - 示例："这道题的关键是理解每个选项的实验目的"

3️⃣ **公式+白话（仅在需要时使用）**
   - **有复杂公式的题目**：给出 LaTeX 公式后，紧跟白话解释
   - **无公式的题目**：不要强行使用公式，直接用自然语言解释

🎨 **第四步：可视化建议（仅在适用时提供）**
- **需要画图的题目**：鼓励学生画受力图、函数图像等
- **不需要画图的题目**：不要强行建议可视化
```
✅ 根据题目类型灵活调整

---

### 2. **新增重要提醒**

在系统提示词中新增：

```
**⚠️ 重要提醒：**
- 不要机械套用"已知条件、隐藏线索、核心方法"的模板
- 根据题目的复杂度和类型，灵活调整引导方式
- 简单题目用简洁自然的语言，复杂题目才需要详细拆解
- 保持对话的自然流畅，避免生硬的格式化表达
```

---

## 📊 对比示例

### 示例1：化学实验题（简单题目）

**题目**：下列哪种保存方法不正确？
- A. 未使用完的钠、钾、白磷，应放回原试剂瓶中
- B. 液溴应密封在玻璃瓶中，加水密封
- C. 活泼金属应保存在煤油中
- D. KMnO₄ 溶液应保存在试剂瓶中

#### 优化前（模板化回复）❌
```
让我们一起解析这道题：

**已知条件：**
- 题目要求选择不正确的保存方法
- 涉及多种化学试剂的保存特性

**隐藏线索：**
- 需要理解每种试剂的化学性质
- 需要判断保存方法是否符合安全要求

**核心方法：**
- 根据化学性质判断保存方法

**可视化建议：**
- 建议你画一个表格，对比每种试剂的保存方法

💡 思考一下：如果我们将钠放回原试剂瓶，会发生什么？
```
❌ 生硬、模板化、过度复杂

#### 优化后（自然回复）✅
```
很好的问题！我注意到你已经找到了这道关于化学试剂保存的题目。

这道题的关键是理解每个选项的实验目的和安全性：

**题目要求：** 选择不正确的保存方法

让我们一起分析每个选项的合理性：
- 钠、钾、白磷这些物质有什么共同特点？
- 它们使用后还能放回原试剂瓶吗？

💡 思考一下：如果某种试剂在使用过程中可能被污染或发生反应，你觉得还能放回原瓶吗？
```
✅ 自然、简洁、针对性强

---

### 示例2：数学题（复杂题目）

**题目**：一辆出租车从13:00到15:00行驶了120公里，求平均速度

#### 优化前和优化后都适用详细拆解✅
```
很好的问题！我注意到你已经找到了时间和距离这两个关键信息。

让我们一起拆解这道题：

**已知条件：**
- 起始时间：13:00
- 结束时间：15:00
- 行驶距离：120公里

**隐藏线索：**
- 需要先计算时间间隔

**核心公式：**
$v=\frac{s}{t}$（速度=距离÷时间）

💡 **白话解释：** 速度就是单位时间内走过的距离

💡 思考一下：从13:00到15:00一共经过了多少小时？
```
✅ 复杂题目需要详细拆解，这样是合适的

---

## 🎯 核心改进点

### 1. **灵活判断题目类型**
- **简单题目**：实验步骤、概念辨析、选择题
  - 用自然语言，直接聚焦核心要点
  - 不套用"已知/隐藏/核心"框架
  
- **复杂题目**：计算题、推导题、综合分析题
  - 使用详细的逻辑拆解
  - 提供公式和白话解释

### 2. **避免强行使用不需要的元素**
- **公式**：只在有复杂公式时使用 LaTeX
- **可视化**：只在需要画图时建议
- **模板**：不机械套用固定格式

### 3. **保持自然流畅**
- 用对话式的语言，而非格式化的列表
- 根据题目实际情况调整详细程度
- 避免生硬的"已知条件：1. 2. 3."

---

## 📈 预期效果

### 用户体验提升
1. ✅ 简单题目得到简洁自然的引导
2. ✅ 复杂题目得到详细深入的分析
3. ✅ 不再看到生硬的模板化回复
4. ✅ AI 的回复更像真人导师

### AI 表现优化
1. ✅ 根据题目复杂度智能调整
2. ✅ 避免过度分析简单题目
3. ✅ 保持回复的自然流畅
4. ✅ 提高引导的针对性

---

## 🔄 实施状态

- [x] 优化引导策略（灵活拆解）
- [x] 新增重要提醒（避免机械套用）
- [x] 更新公式使用规则（仅在需要时）
- [x] 更新可视化建议（仅在适用时）
- [ ] 优化 JSON 格式说明（因转义字符问题待完善）
- [x] 创建优化文档

---

## 🧪 测试建议

### 测试场景1：简单实验题
1. 上传化学实验题（如保存方法选择）
2. 观察 AI 是否避免了"已知条件、隐藏线索"的模板
3. 检查是否用自然语言引导
4. 预期：简洁、自然、针对性强

### 测试场景2：复杂计算题
1. 上传数学计算题（如速度、面积）
2. 观察 AI 是否使用详细拆解
3. 检查是否有公式和白话解释
4. 预期：详细、严谨、逻辑清晰

### 测试场景3：概念辨析题
1. 上传语文近义词辨析题
2. 观察 AI 是否直接聚焦词义差别
3. 检查是否避免了不必要的模板
4. 预期：自然、贴切、情感共鸣

---

## 💡 进一步优化建议

### 1. **题目复杂度评分**
可以让 AI 先评估题目复杂度（1-10分），然后根据分数选择引导策略：
- 1-3分（简单）：简洁自然的引导
- 4-7分（中等）：适度拆解
- 8-10分（复杂）：详细的逻辑拆解

### 2. **题目类型标签**
明确区分题目类型，使用不同的引导模板：
- **选择题**：分析选项差异
- **计算题**：逻辑拆解 + 公式
- **实验题**：实验目的 + 步骤分析
- **概念题**：对比辨析

### 3. **动态调整详细程度**
根据学生的回复，动态调整引导的详细程度：
- 学生理解快 → 简化引导
- 学生困惑多 → 增加细节

---

## 📄 相关文档

- `AI_TUTOR_UPGRADE.md` - 全科辅导老师升级文档
- `CLOSURE_LOGIC.md` - 智能收尾逻辑文档
- `SMART_PROMPT_OPTIMIZATION.md` - 智能提示词优化文档
- `src/services/aiService.js` - AI 服务核心代码

---

**更新时间**：2026-01-13  
**版本**：v2.3 - 避免模板化回复优化  
**状态**：已实施（核心功能完成）
